# 복슬Dir (Boksl Dir) - PRD (Product Requirements Document)

## 문서 개요

본 문서는 복슬Dir의 상세 기능 명세와 구현 계획을 정의합니다.

**관련 문서**: [Requirements.md](Requirements.md)

---

## 🎯 현재 진행 상황 (Quick Status)

**현재 Phase**: Phase 7.2 완료 (터미널 에디터 통합)
**다음 Phase**: Phase 8 - 압축 파일 처리
**전체 진행률**: 8/9 Phases 완료 (89%)

### Phase 1 완료 항목
- ✅ 레이아웃 시스템 (듀얼 패널, 반응형)
- ✅ 색상 테마 시스템 (Dark/Light/High Contrast)
- ✅ 드롭다운 메뉴 시스템 (키보드 네비게이션)
- ✅ 한글 문자 너비 처리 (unicode-width)
- ✅ 시스템 정보 표시 (날짜/시간)

### Phase 2 완료 항목
- ✅ 파일 시스템 모듈 구현 (디렉토리 읽기, 메타데이터 파싱)
- ✅ 포맷터 구현 (파일 크기, 날짜, 권한 포맷팅)
- ✅ 파일 리스트 렌더링 (아이콘, 색상 구분)
- ✅ 파일 정보 컬럼 표시 (이름, 크기, 날짜, 권한)
- ✅ 터미널 크기별 컬럼 자동 조정
- ✅ 한글 파일명 정확한 너비 처리
- ✅ ".." (상위 디렉토리) 항목 표시
- ✅ 상태바에 실제 파일 통계 표시
- ✅ 화살표 키 네비게이션 (↑↓, PageUp/PageDown)
- ✅ 디렉토리 진입/상위 이동 (Enter)
- ✅ 상위 이동 시 이전 디렉토리 포커스 유지
- ✅ 경로 표시 축약 (홈 디렉토리 ~, 중간 생략)

### Phase 3 완료 항목
- ✅ 파일 선택 시스템 (Space, Ctrl+A, +, Ctrl+D)
- ✅ 파일 복사 (F5) - 진행률 표시, 충돌 처리, ESC 취소
- ✅ 파일 이동 (F6) - 복사와 동일한 기능
- ✅ 파일 삭제 (F8) - 휴지통/영구삭제, 확인 다이얼로그, 재귀 삭제
- ✅ 새 디렉토리 생성 (F7) - 입력 다이얼로그, 한글 입력 지원
- ✅ 이름 변경 (F2) - 단일 항목, 입력 다이얼로그
- ✅ 파일 속성 보기 (Alt+Enter) - 메타데이터 표시 다이얼로그

### Phase 4 완료 항목
- ✅ Vim 스타일 키바인딩 (j/k/h/l, y/x/d/D/a/r/i, G, gg 등)
- ✅ 키 시퀀스 시스템 (gg → 맨 위로, 500ms 타임아웃)
- ✅ 단축키 도움말 팝업 (`?` 키, 스크롤 지원)
- ✅ 커맨드 바 Vim 스타일 업데이트
- ✅ 상태바 pending 키 표시 (cyan 색상)
- ✅ Ctrl+R 새로고침, D 영구삭제 추가

### 다음 할 일 (Next Steps)
**Phase 8: 압축 파일 처리**

**현재 블로커**: 없음

---

## 개발 단계 (Phase)

### Phase 0: 프로젝트 초기화
**목표**: 개발 환경 구성 및 기본 프로젝트 구조 생성

**작업 항목**:
- [X] Cargo 프로젝트 초기화
- [X] 의존성 라이브러리 추가 (ratatui, crossterm)
- [X] 프로젝트 디렉토리 구조 설계
- [X] 기본 모듈 스캐폴딩
- [X] 개발 환경 설정 (rustfmt, clippy)

**산출물**:
- `Cargo.toml`
- `src/` 디렉토리 구조
- 기본 main.rs (Hello World TUI)

---

### Phase 1: UX/UI 기반 구조 ✅ (완료)
**목표**: 반응형 레이아웃 시스템과 테마 시스템 구현
**상태**: 완료
**완료일**: 2026-02-01

#### 구현 순서 (Implementation Order)

이 Phase는 다음 순서로 구현되었습니다:

1. **레이아웃 시스템** (우선순위 1) - 모든 UI의 기초
   - 의존성: 없음
   - 상태: ✅ 완료

2. **색상 테마 시스템** (우선순위 2) - UI 컴포넌트가 테마 의존
   - 의존성: 없음 (독립적)
   - 상태: ✅ 완료

3. **UI 컴포넌트 구현** (우선순위 3) - 병렬 작업 가능
   - 의존성: 레이아웃, 테마
   - 상태: ✅ 기본 구현 완료

4. **기본 인터랙션** (우선순위 4) - 병렬 작업 가능
   - 의존성: UI 컴포넌트
   - 상태: ✅ 완료

5. **드롭다운 메뉴 시스템** (우선순위 5) - 마지막
   - 의존성: 메뉴바, 테마, 인터랙션
   - 상태: ✅ 완료

---

#### 1.1 레이아웃 시스템
**우선순위**: 1 (필수)
**의존성**: 없음
**상태**: ✅ 완료
**작업 항목**:
- [X] 터미널 크기 감지 및 처리
- [X] 레이아웃 컴포넌트 설계
  - [X] 상단 메뉴바 컴포넌트
  - [X] 듀얼 패널 컨테이너
  - [X] 하단 커맨드 바 컴포넌트
  - [X] 상태바 컴포넌트
- [X] 반응형 레이아웃 시스템
  - [X] 최소 터미널 크기 정의 (예: 80x24)
  - [X] 크기별 레이아웃 조정 로직
  - [X] 패널 너비 비율 조정 (50:50, 70:30 등)
- [X] 레이아웃 모드
  - [X] 듀얼 패널 모드 (기본)
  - [X] 싱글 패널 모드 (좁은 화면)
- [X] 터미널 크기 변경 이벤트 처리
- [X] 레이아웃 상태 관리

**세부 레이아웃 스펙**:

```
┌─────────────────────────────────────────────────────────────────┐
│ 상단 메뉴바 (높이: 1줄)                                          │
│ [복슬Dir] 파일(F) 편집(E) 보기(V) 도구(T) 설정(S) 도움말(H)       │
├──────────────────────────────┬──────────────────────────────────┤
│                              │                                  │
│   좌측 패널                   │   우측 패널                       │
│   (너비: 50%)                 │   (너비: 50%)                    │
│                              │                                  │
│   파일 리스트 영역            │   파일 리스트 영역                │
│   (높이: 터미널 높이 - 4)     │   (높이: 터미널 높이 - 4)         │
│                              │                                  │
├──────────────────────────────┴──────────────────────────────────┤
│ 상태바 (높이: 1줄)                                               │
│ 123 files, 45 dirs | 1.2GB                                      │
├──────────────────────────────────────────────────────────────────┤
│ 하단 커맨드 바 (높이: 1줄)                                        │
│ F1:Help F2:Menu F3:View F4:Edit F5:Copy F6:Move F7:Dir F8:Del   │
└──────────────────────────────────────────────────────────────────┘
```

**드롭다운 메뉴 레이아웃** (메뉴 활성화 시):
```
┌─────────────────────────────────────────────────────────────────┐
│ [복슬Dir] 파일(F) 편집(E) 보기(V) 도구(T) 설정(S) 도움말(H)       │
├─────────────┬───────────────────────────────────────────────────┤
│ 새 파일  ^N │                                                   │
│ 새 폴더  F7 │   좌측 패널                                        │
│─────────────│                                                   │
│ 열기  Enter │                                                   │
│ 연결 프로그램▶├──────────────┐                                   │
│─────────────│ 기본 프로그램 │                                   │
│ 이름변경 F2 │ VS Code      │                                   │
│ 삭제     F8 │ vim          │                                   │
│─────────────│──────────────│                                   │
│ 종료    F10 │ 선택...      │                                   │
└─────────────┴──────────────┴───────────────────────────────────┘
  (드롭다운)    (서브메뉴)
```

**반응형 규칙**:
- **80x24 이상**: 듀얼 패널 모드
- **40x24 ~ 79x24**: 싱글 패널 모드 (Tab으로 전환)
- **40x24 미만**: 경고 메시지 표시

**레이아웃 측정 단위**:
- Constraint::Percentage(50) - 비율 기반
- Constraint::Min(20) - 최소 크기
- Constraint::Length(1) - 고정 크기

#### 1.2 색상 테마 시스템
**우선순위**: 2 (필수)
**의존성**: 없음 (독립적)
**상태**: ✅ 대부분 완료 (TOML 파일 지원 제외)

**작업 항목**:
- [X] 테마 데이터 구조 설계
- [X] 기본 테마 구현
  - [X] Dark 테마 (기본)
  - [X] Light 테마
  - [X] High Contrast 테마
- [X] 테마별 색상 팔레트 정의
- [X] 테마 적용 시스템
- [X] 런타임 테마 전환 기능
- [ ] 테마 설정 파일 지원 (TOML)

**색상 팔레트 스펙**:

각 테마는 다음 색상을 정의해야 함:

```rust
struct Theme {
    // 배경/전경
    bg_primary: Color,
    fg_primary: Color,

    // 패널
    panel_active_border: Color,
    panel_inactive_border: Color,
    panel_bg: Color,

    // 파일 리스트
    file_normal: Color,
    file_selected: Color,
    file_selected_bg: Color,
    directory: Color,
    executable: Color,
    symlink: Color,

    // UI 컴포넌트
    menu_bar_bg: Color,
    menu_bar_fg: Color,
    status_bar_bg: Color,
    status_bar_fg: Color,
    command_bar_bg: Color,
    command_bar_fg: Color,

    // 강조
    accent: Color,
    warning: Color,
    error: Color,
    success: Color,
}
```

**테마 예시 (Dark)**:
```toml
[theme.dark]
bg_primary = "#1e1e1e"
fg_primary = "#d4d4d4"
panel_active_border = "#0078d4"
panel_inactive_border = "#3c3c3c"
file_normal = "#d4d4d4"
file_selected = "#ffffff"
file_selected_bg = "#0078d4"
directory = "#569cd6"
executable = "#4ec9b0"
symlink = "#ce9178"
menu_bar_bg = "#2d2d30"  # 어두운 배경으로 선택된 메뉴 강조
menu_bar_fg = "#ffffff"
accent = "#0078d4"
warning = "#ffa500"
error = "#f44747"
success = "#4ec9b0"
```

#### 1.3 UI 컴포넌트 구현
**우선순위**: 3 (필수)
**의존성**: 레이아웃 시스템, 테마 시스템
**상태**: ✅ 기본 구현 완료

**작업 항목**:
- [X] 상단 메뉴바
  - [X] 앱 이름 표시
  - [X] 메뉴 항목 표시 (파일, 편집, 보기, 도구, 설정, 도움말)
  - [X] 시스템 정보 (날짜/시간) - 오른쪽 정렬
- [X] 파일 패널 위젯
  - [X] 테두리 렌더링 (활성/비활성)
  - [X] 헤더 (경로)
  - [X] 빈 패널 상태 처리
  - [ ] 정렬 정보 표시
- [X] 하단 커맨드 바
  - [X] F1~F12 단축키 표시
  - [ ] 동적 단축키 업데이트
- [X] 상태바
  - [X] 기본 레이아웃
  - [ ] 파일/디렉토리 개수
  - [ ] 총 크기
  - [ ] 선택된 항목 정보

#### 1.4 기본 인터랙션
**우선순위**: 4 (필수)
**의존성**: UI 컴포넌트
**상태**: ✅ 완료

**작업 항목**:
- [X] 키보드 이벤트 처리 구조
- [X] 기본 단축키 매핑
  - [X] `q` - 종료
  - [X] `Tab` - 패널 전환
  - [X] `F9` - 메뉴 활성화
  - [X] `F10` - 종료
  - [X] `Ctrl+C` - 종료
  - [X] `Esc` - 메뉴 닫기
- [ ] 마우스 이벤트 처리 (클릭으로 패널 선택)
- [X] 이벤트 루프 구현

#### 1.5 드롭다운 메뉴 시스템
**우선순위**: 5 (필수)
**의존성**: 메뉴바, 테마, 기본 인터랙션
**상태**: ✅ 완료

**목표**: 단축키로 접근할 수 없는 기능을 메뉴로 제공

**작업 항목**:
- [X] 메뉴 데이터 구조 설계
  - [X] MenuItem (id, label, shortcut, enabled, submenu)
  - [X] Menu (title, items)
  - [X] MenuBar (menus)
- [X] 메뉴바 렌더링
  - [X] 상단 고정 메뉴 항목 표시
  - [X] 활성 메뉴 하이라이트
  - [X] 단축키 표시 (파일(F) 형식)
  - [X] 한글 문자 너비 정확한 계산 (unicode-width)
  - [X] 메뉴 간 간격 및 양쪽 여백 조정
  - [X] 메뉴바 배경색 최적화 (가시성 향상)
- [X] 드롭다운 메뉴 렌더링
  - [X] 1단계 메뉴 (메인 메뉴)
  - [X] 2단계 메뉴 (서브메뉴, 화살표로 표시)
  - [X] 메뉴 테두리
  - [X] 비활성 항목 회색 처리
  - [X] 구분선 지원
  - [X] 서브메뉴 열릴 때 부모 항목 하이라이트 유지
- [X] 메뉴 인터랙션
  - [X] F9 키로 메뉴 활성화
  - [X] 화살표 키로 메뉴 탐색
    - [X] ←→ 대메뉴 간 이동 (서브메뉴 영향 없음)
    - [X] ↑↓ 드롭다운 항목 이동
    - [X] Enter로 서브메뉴 열기 또는 액션 실행
  - [X] Esc로 메뉴 닫기
  - [ ] 마우스 클릭으로 메뉴 열기/선택
  - [ ] 마우스 호버로 메뉴 항목 하이라이트
- [X] 메뉴 상태 관리
  - [X] 메뉴 열림/닫힘 상태
  - [X] 현재 선택된 메뉴/항목 추적
  - [X] 서브메뉴 열림 상태

**구현된 UX 개선사항**:
- **직관적인 네비게이션**: 좌우 화살표로 대메뉴를 빠르게 이동하고, Enter로 명시적으로 서브메뉴 열기
- **한글 문자 처리**: unicode-width 크레이트를 사용하여 CJK 문자의 터미널 표시 너비 정확히 계산
- **시각적 개선**: 메뉴 항목 양쪽 여백 균등화, 메뉴바 배경색 어두운 회색(#2d2d30)으로 변경하여 선택된 메뉴 강조

**기본 메뉴 구조**:
```
┌─────────────────────────────────────────────────────────────────┐
│ [복슬Dir] 파일(F)  편집(E)  보기(V)  도구(T)  설정(S)  도움말(H)    │
├─────────────────────────────────────────────────────────────────┤
```

**메뉴 항목 예시**:
```
파일(F)
├── 새 파일 생성          Ctrl+N
├── 새 디렉토리 생성       F7
├── ─────────────────
├── 파일 열기             Enter
├── 연결 프로그램 ▶       (서브메뉴)
│   ├── 기본 프로그램
│   ├── VS Code
│   ├── vim
│   └── 프로그램 선택...
├── ─────────────────
├── 이름 변경             F2
├── 삭제                  F8
├── ─────────────────
└── 종료                  F10

편집(E)
├── 복사                  F5
├── 이동                  F6
├── ─────────────────
├── 전체 선택             Ctrl+A
├── 선택 반전             *
└── 선택 해제             Ctrl+D

보기(V)
├── 새로고침              Ctrl+R
├── ─────────────────
├── 정렬 기준 ▶
│   ├── 이름
│   ├── 크기
│   ├── 수정 날짜
│   └── 확장자
├── 정렬 순서 ▶
│   ├── 오름차순
│   └── 내림차순
├── ─────────────────
├── 숨김 파일 표시        Ctrl+H
└── 파일 정보 표시        Ctrl+I

도구(T)
├── 터미널 열기           Ctrl+O
├── 명령어 실행           Ctrl+E
├── ─────────────────
├── 파일 검색             Ctrl+F
├── 파일 비교
└── 디스크 사용량

설정(S)
├── 테마 ▶
│   ├── Dark (기본)
│   ├── Light
│   └── High Contrast
├── 패널 비율 ▶
│   ├── 50:50
│   ├── 70:30
│   └── 30:70
├── ─────────────────
├── 단축키 설정
├── 파일 연결 설정
└── 환경 설정...          F12

도움말(H)
├── 단축키 도움말         F1
├── 사용 설명서
├── ─────────────────
└── 복슬Dir 정보
```

**드롭다운 UI 스펙**:
```
┌─────────────────────┐
│ 새 파일 생성   Ctrl+N│
│ 새 디렉토리     F7   │
├─────────────────────┤
│ 파일 열기     Enter  │
│ 연결 프로그램    ▶  │──┬─────────────────┐
├─────────────────────┤  │ 기본 프로그램    │
│ 이름 변경       F2   │  │ VS Code         │
│ 삭제            F8   │  │ vim             │
├─────────────────────┤  ├─────────────────┤
│ 종료           F10   │  │ 프로그램 선택...│
└─────────────────────┘  └─────────────────┘
```

**산출물**:
- 완전히 동작하는 빈 듀얼 패널 UI
- 테마 전환 가능한 시스템
- 반응형 레이아웃
- 기본 키보드/마우스 인터랙션

---

### Phase 2: 파일 시스템 통합 ✅ (완료)
**목표**: 파일 시스템 읽기 및 표시 기능 구현
**상태**: 완료
**시작일**: 2026-02-01
**완료일**: 2026-02-05

#### 구현 순서 (Implementation Order)

1. **파일 시스템 모듈** (우선순위 1) - 기반 작업
2. **파일 리스트 렌더링** (우선순위 2) - UI 표시
3. **파일 탐색 기능** (우선순위 3) - 인터랙션

---

#### 2.1 파일 시스템 모듈
**우선순위**: 1 (Phase 2 내)
**의존성**: 없음 (Phase 1 완료 필요)
**상태**: ✅ 완료
**완료일**: 2026-02-01
**작업 항목**:
- [x] 디렉토리 읽기 기능
- [x] 파일 메타데이터 파싱 (크기, 날짜, 권한)
- [x] 파일 타입 감지 (디렉토리, 파일, 심볼릭 링크, 실행 파일)
- [x] 숨김 파일 처리
- [x] 에러 처리 (권한 없음, 존재하지 않는 경로)

#### 2.2 파일 리스트 렌더링
**우선순위**: 2 (Phase 2 내)
**의존성**: 파일 시스템 모듈
**상태**: ✅ 완료
**완료일**: 2026-02-01

**작업 항목**:
- [x] 파일 리스트 위젯 구현
- [x] 파일명 표시
- [x] 아이콘/색상 구분 (디렉토리, 파일 타입별)
- [x] 파일 정보 컬럼 (크기, 날짜, 권한)
- [x] 스크롤 처리
- [x] 리스트 항목 선택 UI

**파일 리스트 포맷**:
```
┌─ /home/user/projects ────────────────────┐
│ Name             Size      Modified       │
├───────────────────────────────────────────┤
│ [..] <UP>                                 │
│ 📁 src/          -         2026-01-30     │
│ 📁 docs/         -         2026-01-29     │
│ 📄 Cargo.toml    1.2KB     2026-01-28     │
│ 📄 README.md     3.4KB     2026-01-27     │
│ 🔧 build.sh      512B      2026-01-26     │
└───────────────────────────────────────────┘
```

#### 2.3 파일 탐색 기능
**우선순위**: 3 (Phase 2 내)
**의존성**: 파일 리스트 렌더링
**상태**: ✅ 완료
**완료일**: 2026-02-05

**작업 항목**:
- [x] 화살표 키 네비게이션 (↑↓)
- [x] 디렉토리 진입 (Enter)
- [x] 상위 디렉토리 이동 (..)
- [x] 패널 간 경로 독립성 유지
- [x] 패널 상태 저장
- [x] PageUp/PageDown 페이지 단위 이동
- [x] 상위 디렉토리 이동 시 이전 디렉토리 포커스 유지
- [x] 경로 표시 축약 (홈 디렉토리 ~, 중간 생략)
- [x] 선택 항목 전체 행 하이라이트

---

### Phase 3: 파일 작업 ✅ (완료)
**목표**: 파일 복사, 이동, 삭제 등 핵심 작업 구현
**상태**: 완료
**완료일**: 2026-02-08

#### 3.1 파일 선택 시스템 ✅
**작업 항목**:
- [x] 단일 선택 (커서 위치)
- [x] 다중 선택 (Space) - 토글 + 커서 아래로 이동
- [x] 전체 선택 (`*` 또는 `Ctrl+A`)
- [x] 선택 반전 (`+`)
- [x] 선택 해제 (`Ctrl+D`)
- [x] 선택 항목 하이라이트 (골드색 + `*` 마커)
- [x] 상태바에 선택 개수/크기 표시
- [x] 디렉토리 변경 시 선택 초기화
- [x] ".." 항목 선택 불가

#### 3.2 파일 복사/이동 ✅
**작업 항목**:
- [x] 파일 복사 (F5)
  - [x] 단일 파일 복사
  - [x] 다중 파일 복사
  - [x] 디렉토리 재귀 복사
  - [x] 진행률 표시 (파일 건수 + 바이트 크기)
  - [x] 대상 경로 입력 다이얼로그
  - [x] 덮어쓰기 확인 (Overwrite/Skip/OverwriteAll/SkipAll/Cancel)
- [x] 파일 이동 (F6)
  - [x] 복사와 동일한 기능
  - [x] 이동 후 원본 삭제
- [x] 에러 처리
  - [x] 권한 없음
  - [x] 디스크 공간 부족 (에러 메시지 표시)
  - [x] 같은 이름 파일 존재 (충돌 다이얼로그)
- [x] 추가 구현
  - [x] 재귀 복사/이동 방지 (자기 자신 내부로 복사 차단)
  - [x] 진행 중 ESC 취소 기능
  - [x] 작업 완료/취소 시 양쪽 패널 새로고침

#### 3.3 파일 삭제 ✅
**작업 항목**:
- [x] 파일 삭제 (F8)
- [x] 확인 다이얼로그
- [x] 재귀 디렉토리 삭제
- [x] 휴지통 이동 vs 영구 삭제 옵션
- [x] 에러 처리

#### 3.4 기타 파일 작업 ✅
**작업 항목**:
- [x] 새 디렉토리 생성 (F7) - MkdirInput 다이얼로그, 한글 입력 지원
- [x] 파일/디렉토리 이름 변경 (F2) - RenameInput 다이얼로그, 현재 이름 프리필
- [x] 파일 속성 보기 (Alt+Enter) - Properties 다이얼로그, 메타데이터 표시
- [x] 메뉴 연동 (파일 > 새 폴더, 이름 변경, 파일 정보)
- [x] 모든 입력 다이얼로그 UTF-8 커서 처리 (한글 등 멀티바이트 문자 안전 입력)

---

### Phase 4: 단축키 시스템 리팩토링 (Vim 스타일)
**목표**: F키 중심에서 Vim 스타일 단축키로 전환, 단축키 도움말 팝업 제공
**상태**: 완료

#### 설계 배경

기존 F키 기반 단축키의 한계:
- F키 개수 제약 (F1~F12)
- F2 등 키 충돌 (이름 변경 vs 파일 열기)
- 터미널/tmux 환경에서 Shift+F키 호환성 문제
- 숙련자 속도 저하 (F키는 홈 로우에서 손 이동 필요)

Vim 스타일 장점:
- 니모닉(mnemonic) 단일 문자 키 → 빠른 조작
- 수정자 키 최소 사용 → 터미널 호환성 높음
- 키 시퀀스로 무한 확장 가능

#### 4.1 Vim 스타일 키바인딩

**전체 키바인딩 매핑표 (Normal 모드)**:

| 카테고리      | Vim 키        | 동작                       | F키 (호환 유지)      |
| ------------- | ------------- | -------------------------- | -------------------- |
| **탐색**      | `j` / `↓`     | 커서 아래로                | ↓                    |
|               | `k` / `↑`     | 커서 위로                  | ↑                    |
|               | `h` / `←`     | 상위 디렉토리              | (신규)               |
|               | `l` / `Enter` | 디렉토리 진입 / 파일 열기  | Enter                |
|               | `gg`          | 목록 맨 위로               | Home                 |
|               | `G`           | 목록 맨 아래로             | End                  |
|               | `Ctrl+U`      | 반 페이지 위로             | PageUp               |
|               | `Ctrl+D`      | 반 페이지 아래로           | PageDown             |
| **파일 조작** | `y`           | 복사 (다이얼로그)          | F5                   |
|               | `x`           | 이동/잘라내기 (다이얼로그) | F6                   |
|               | `d`           | 삭제 (휴지통 확인)         | F8                   |
|               | `D`           | 영구 삭제 (확인)           | (신규)               |
|               | `a`           | 새 디렉토리 생성           | F7                   |
|               | `r`           | 이름 변경                  | F2                   |
|               | `i`           | 파일 속성 보기             | Alt+Enter            |
| **선택**      | `Space`       | 선택 토글 + 커서 아래로    | Space                |
|               | `v`           | 선택 반전                  | (기존 `+` 대체)      |
|               | `Ctrl+A`      | 전체 선택                  | (기존 `*` 대체)      |
|               | `u`           | 전체 선택 해제             | (기존 `Ctrl+D` 대체) |
| **시스템**    | `q` / `F10`   | 종료                       | F10                  |
|               | `Tab`         | 패널 전환                  | Tab                  |
|               | `F9`          | 메뉴 활성화                | F9                   |
|               | `?`           | 단축키 도움말 팝업         | (신규)               |
|               | `Ctrl+R`      | 새로고침                   | (신규)               |

**제거되는 키바인딩**:
- `*` (전체 선택) → `Ctrl+A`로 통합
- `+` (선택 반전) → `v`로 대체
- `Ctrl+D` (선택 해제) → `u`로 대체 (Ctrl+D는 반 페이지 아래로)

**호환성 유지 F키**: F2, F5, F6, F7, F8, F9, F10

**작업 항목**:
- [x] Vim 네비게이션 키 추가 (j/k/h/l/G)
- [x] Vim 파일 조작 키 추가 (y/x/d/D/a/r/i)
- [x] Vim 선택 키 변경 (v, u)
- [x] `Ctrl+D` 용도 변경 (선택 해제 → 반 페이지 아래로)
- [x] `Ctrl+U` 반 페이지 위로 추가
- [x] `Ctrl+R` 새로고침 추가
- [x] 기존 `*`, `+` 제거

#### 4.2 키 시퀀스 시스템

**작업 항목**:
- [x] `pending_key` 상태 구현 (App 구조체에 `Option<char>` 필드)
- [x] `g` 키 입력 시 pending 상태 진입
- [x] pending 상태에서 `g` 입력 시 `gg` 실행 (목록 맨 위로)
- [x] pending 상태에서 다른 키 또는 타임아웃(~500ms) 시 pending 해제
- [x] 상태바에 pending 키 표시 (예: `g_`)

#### 4.3 단축키 도움말 팝업 (`?`)

**작업 항목**:
- [x] `DialogKind::Help` 추가
- [x] `?` 키로 도움말 다이얼로그 열기
- [x] 카테고리별 정리 (탐색, 파일 조작, 선택, 시스템)
- [x] 스크롤 지원 (j/k 또는 ↑/↓)
- [x] Esc/q/? 로 닫기
- [x] `/` 검색 모드 진입 (키/설명 대상, 부분 일치, 대소문자 무시)
- [x] 검색 결과 수 표시 및 매칭 강조
- [x] Esc 동작 분리 (검색어 있으면 해제, 없으면 닫기)

**도움말 팝업 UI 스펙**:
```
┌─── 단축키 도움말 (Normal 모드) ─────────────────┐
│                                                  │
│ [탐색]                                           │
│   j/↓    커서 아래로      k/↑    커서 위로       │
│   h/←    상위 디렉토리    l/Enter 디렉토리 진입  │
│   gg     목록 맨 위       G      목록 맨 아래    │
│   Ctrl+U 반 페이지 위     Ctrl+D 반 페이지 아래  │
│                                                  │
│ [파일 조작]                                      │
│   y/F5   복사             x/F6   이동            │
│   d/F8   삭제(휴지통)     D      영구 삭제       │
│   a/F7   새 디렉토리      r/F2   이름 변경       │
│   i      파일 속성                               │
│                                                  │
│ [선택]                                           │
│   Space  선택 토글        v      선택 반전        │
│   Ctrl+A 전체 선택        u      전체 해제        │
│                                                  │
│ [시스템]                                         │
│   q/F10  종료             Tab    패널 전환        │
│   F9     메뉴             ?      이 도움말        │
│   Ctrl+R 새로고침                                │
│                                                  │
│               [ 닫기 (Esc) ]                     │
└──────────────────────────────────────────────────┘
```

#### 4.4 커맨드 바 업데이트

**작업 항목**:
- [x] 기존 F키 전용 표시에서 Vim 키 표시로 변경
- [x] 표시 형식: `y:Copy x:Move d:Del a:New r:Ren i:Info ?:Help q:Quit`

**완료 기준**:
- [x] 모든 Vim 스타일 키바인딩 동작
- [x] F키 호환성 유지 (F2, F5~F10)
- [x] `gg` 키 시퀀스 동작
- [x] `?` 도움말 팝업 표시
- [x] 커맨드 바에 새 키바인딩 표시

---

### Phase 5: 파일 정렬 및 필터링
**목표**: 파일 리스트 정렬, 검색, 필터링 기능

#### 5.1 정렬 기능
**작업 항목**:
- [x] 정렬 기준
  - [x] 이름 (오름차순/내림차순)
  - [x] 크기
  - [x] 수정 날짜
  - [x] 확장자
- [x] 디렉토리 우선 표시 옵션
- [x] 정렬 상태 표시 (UI에 화살표)
- [x] 단축키로 정렬 변경

#### 5.2 검색 및 필터링
**작업 항목**:
- [x] 빠른 검색 (타이핑으로 필터링) — `/` 키, 라이브 필터링
- [x] 파일명 패턴 필터링 (*.rs, *.md) — 글로브 패턴 `*`, `?` 지원
- [x] 파일 내용 검색 (grep) — `f` 키, GrepInput/GrepResults 다이얼로그
- [x] 재귀 검색 — GrepInput Recursive 옵션
- [x] 검색 결과 하이라이트 — 필터: 매칭 부분 밑줄+강조, Grep: 결과 목록 하이라이트

#### 5.3 기타 탐색 기능
**작업 항목**:
- [x] 숨김 파일 표시/숨김 토글 — `.` 키, 양쪽 패널 동시 토글, 상태바 [Hidden] 표시
- [x] 드라이브/마운트 포인트 빠른 접근 — `gm` 키 시퀀스, 선택형 다이얼로그
- [x] 파일 크기 표시 형식 (KB, MB, GB) — 보기 메뉴 > 크기 표시 형식 (자동/바이트)

---

### Phase 6: 내비게이션 고급 기능
**목표**: 탭, 히스토리, 북마크 등 편의 기능

#### 6.1 탭 시스템
**작업 항목**:
- [x] 탭 데이터 구조 설계
- [x] 탭 생성/닫기
- [x] 탭 전환 (단축키)
- [x] 탭 UI 렌더링
- [x] 각 탭별 상태 저장

#### 6.2 디렉토리 히스토리
**작업 항목**:
- [x] 방문 디렉토리 히스토리 저장
- [x] 앞으로/뒤로 가기 (Alt+←, Alt+→)
- [x] 히스토리 목록 보기
- [x] 히스토리 목록에서 현재 패널 히스토리 전체 삭제
- [x] 프로그램 재시작 후 이전 히스토리 복원

#### 6.3 북마크 시스템
**작업 항목**:
- [x] 북마크 추가 (Ctrl+B)
- [x] 북마크 목록 보기
- [x] 북마크로 이동
- [x] 북마크 편집/삭제
- [x] 북마크 설정 파일 저장

#### 6.4 경로 입력 및 자동완성 ✅
**작업 항목**:
- [x] 경로 직접 이동 다이얼로그 (`gp`)
- [x] 파일 시스템 기반 자동완성 (디렉토리 기준)
- [x] 히스토리 기반 자동완성 (활성 탭 히스토리 우선)
- [x] Ghost text 미리보기
- [x] Tab 키 자동완성 (Shift+Tab 버튼 전환 유지)
- [x] 입력 편집 단축키: 이전 단어 삭제 (`Ctrl+W`)

---

### Phase 7: 외부 프로그램 연동
**목표**: 외부 프로그램 실행 및 파일 연결

#### 7.1 파일 연결 프로그램
**작업 항목**:
- [x] OS 기본 프로그램으로 열기

참고: 현재 구현은 macOS 우선 (`open` 명령 기반)입니다.

#### 7.2 터미널 에디터 통합
**작업 항목**:
- [x] TUI raw mode 해제/재활성화
- [x] 에디터 실행 (vi, vim, nano, emacs)
- [x] 에디터 종료 후 복귀
- [x] 기본 에디터 설정

---

### Phase 8: 압축 파일 처리
**목표**: 압축/압축 해제 기능

**작업 항목**:
- [ ] 압축 형식 지원 (zip, tar, tar.gz, 7z)
- [ ] 압축 파일 미리보기 (내부 파일 목록)
- [ ] 압축 해제
- [ ] 파일/폴더 압축
- [ ] 압축 진행률 표시

---

### Phase 9: 커스터마이징
**목표**: 사용자 설정 시스템

#### 9.1 단축키 커스터마이징
**작업 항목**:
- [ ] 키바인딩 설정 파일
- [ ] 런타임 키바인딩 변경
- [ ] 키바인딩 충돌 감지
- [ ] 기본 키바인딩 복원

#### 9.2 설정 파일 시스템
**작업 항목**:
- [ ] TOML 설정 파일 파싱
- [ ] 설정 우선순위 (기본값 < 전역 설정 < 사용자 설정)
- [ ] 설정 값 검증
- [ ] 설정 변경 시 즉시 적용

#### 9.3 설정 UI
**작업 항목**:
- [ ] 설정 다이얼로그
- [ ] 설정 항목 편집
- [ ] 설정 저장

---

## UI/UX 상세 명세

### 1. 반응형 레이아웃 상세

#### 크기별 동작

**대형 화면 (120+ 컬럼)**:
- 듀얼 패널 50:50 비율
- 모든 컬럼 표시 (이름, 크기, 날짜, 권한)
- 상단 메뉴바에 추가 정보 표시

**표준 화면 (80-119 컬럼)**:
- 듀얼 패널 50:50 비율
- 필수 컬럼만 표시 (이름, 크기, 날짜)

**소형 화면 (40-79 컬럼)**:
- 싱글 패널 모드
- 최소 컬럼 (이름, 크기)
- Tab으로 좌/우 패널 전환

**초소형 화면 (<40 컬럼)**:
- 경고 메시지 표시
- 최소 80x24 권장 안내

#### 높이별 동작

**표준 (24+ 줄)**:
- 모든 UI 요소 표시

**좁은 높이 (15-23 줄)**:
- 상단 메뉴바 또는 하단 커맨드 바 숨김 옵션

**매우 좁음 (<15 줄)**:
- 경고 메시지 표시

---

### 2. 색상 테마 전환

**테마 전환 방법**:
1. 설정 파일에서 기본 테마 지정
2. 런타임 단축키로 전환 (예: `Ctrl+T`)
3. 설정 UI에서 선택

**테마 파일 위치**:
- `~/.config/boksldir/themes/`
- `dark.toml`, `light.toml`, `custom.toml`

---

### 3. 다이얼로그 시스템

모든 대화형 작업(복사, 삭제, 이름 변경 등)은 다이얼로그를 사용합니다.

**다이얼로그 종류**:
- 입력 다이얼로그 (텍스트 입력)
- 확인 다이얼로그 (Yes/No)
- 선택 다이얼로그 (옵션 목록)
- 진행률 다이얼로그

**예시 - 파일 삭제 확인**:
```
┌────────────────────────────────────┐
│ Delete Confirmation                │
├────────────────────────────────────┤
│ Delete 3 selected items?           │
│                                    │
│ - file1.txt                        │
│ - file2.rs                         │
│ - folder/                          │
│                                    │
│ This action cannot be undone.      │
│                                    │
│   [ Yes ]    [ No ]                │
└────────────────────────────────────┘
```

---

## 비기능 요구사항

### 성능
- 10,000개 이상 파일 디렉토리 렌더링 시 60fps 유지
- 파일 작업 시 UI 블로킹 최소화 (비동기 처리)
- 메모리 사용량 < 50MB (idle 상태)

### 호환성
- macOS 10.15+
- Linux (Ubuntu 20.04+, Fedora 35+)
- Windows 10+

### 안정성
- 권한 오류, I/O 오류 등 모든 에러 처리
- 크래시 시 상태 복구
- 데이터 손실 방지

### 사용성
- 키 입력 반응 지연 < 16ms
- 직관적인 단축키
- 명확한 에러 메시지

### 알려진 제약사항
- **macOS 한글 입력 (IME) 표시 문제**:
  - **현상**: 한글 입력 모드에서 키를 누르면 터미널에 한글 문자가 일시적으로 표시될 수 있음
  - **원인**: macOS의 IME가 터미널 에뮬레이터 레벨에서 동작하여 애플리케이션에서 제어 불가능
  - **영향**: 시각적으로만 표시되며, 프로그램 로직에는 영향 없음
  - **권장 사항**: 프로그램 사용 중에는 영문 입력 모드 사용
  - **기술적 배경**: crossterm/ratatui의 raw mode로는 터미널 에뮬레이터의 IME 버퍼를 제어할 수 없음

---

## 기술 스택

### Core
- **Rust**: 2021 Edition, latest stable
- **ratatui**: ^0.28
- **crossterm**: ^0.28

### Additional
- **tokio**: 비동기 I/O (파일 작업)
- **serde**: 설정 파일 직렬화
- **toml**: 설정 파일 포맷
- **dirs**: 시스템 디렉토리 경로
- **chrono**: 날짜/시간 포맷팅
- **unicode-width**: 한글/CJK 문자 터미널 표시 너비 계산
- **zip/tar**: 압축 파일 처리
- **anyhow**: 에러 처리

---

## 산출물 체크리스트

### Phase 1 완료 기준
- [X] 터미널에서 듀얼 패널 UI 표시
- [X] 창 크기 변경 시 레이아웃 자동 조정
- [X] 3개 이상의 테마 전환 가능
- [X] Tab 키로 패널 전환
- [X] 드롭다운 메뉴 시스템 구현
- [X] 한글 문자 너비 정확한 처리 (렌더링)
- [ ] 마우스 클릭으로 패널 선택 (Phase 2 이후)

### Phase 2 완료 기준
- [X] 실제 파일 시스템 디렉토리 표시
- [X] 화살표 키로 파일 선택
- [X] Enter로 디렉토리 진입
- [X] .. 으로 상위 디렉토리 이동
- [X] 파일 타입별 색상 구분

### Phase 3 완료 기준
- [x] F5로 파일 복사
- [x] F6로 파일 이동
- [x] F8로 파일 삭제
- [x] 진행률 표시
- [x] 에러 처리 및 메시지 표시
- [x] F7로 새 디렉토리 생성
- [x] F2로 이름 변경
- [x] Alt+Enter로 파일 속성 보기

### Phase 4 완료 기준
- [ ] Vim 스타일 키바인딩 동작 (j/k/h/l, y/x/d/D/a/r/i)
- [ ] F키 호환성 유지 (F2, F5~F10)
- [ ] `gg` 키 시퀀스 동작
- [ ] `?` 단축키 도움말 팝업 표시
- [ ] 커맨드 바 Vim 키 병행 표시

---

**문서 버전**: 1.6.0
**최종 수정일**: 2026-02-17
**다음 리뷰 예정일**: Phase 8 완료 후

**주요 업데이트 (v1.6.0)**:
- Phase 7(파일 뷰어) 제거
- 기존 Phase 8~10을 Phase 7~9로 리넘버링
- Quick Status 다음 단계를 "Phase 7 - 외부 프로그램 연동"으로 변경
- 전체 Phase 수: 10 → 9

**이전 주요 업데이트 (v1.5.0)**:
- Phase 4 삽입: 단축키 시스템 리팩토링 (Vim 스타일)
  - Vim 스타일 키바인딩 전체 설계 (j/k/h/l, y/x/d/D/a/r/i/v/u)
  - 키 시퀀스 시스템 설계 (gg)
  - 단축키 도움말 팝업 설계 (`?`)
  - 커맨드 바 업데이트 설계
- 기존 Phase 4~9를 Phase 5~10으로 리넘버링
- 전체 Phase 수: 9 → 10

**이전 버전 (v1.4.0)**:
- Phase 3 전체 완료
- Phase 3.4 기타 파일 작업 구현
  - F7: 새 디렉토리 생성 (MkdirInput 다이얼로그)
  - F2: 파일/디렉토리 이름 변경 (RenameInput 다이얼로그, 단일 항목)
  - Alt+Enter: 파일 속성 보기 (Properties 다이얼로그)
  - 모든 입력 다이얼로그 UTF-8 커서 처리 수정 (한글 입력 안정화)

**이전 버전 (v1.3.0)**:
- Phase 3.1 파일 선택 시스템 완료
- Phase 3.2 파일 복사/이동 완료
  - 진행률 표시 (파일 건수 + 바이트 크기)
  - 충돌 처리 (Overwrite/Skip/OverwriteAll/SkipAll/Cancel)
  - 재귀 복사/이동 방지
  - ESC 취소 기능

**이전 버전 (v1.2.1)**:
- macOS 한글 입력 (IME) 제약사항 문서화
- 한글이 화면에 표시되는 것은 터미널 레벨의 동작으로 제어 불가능
- Phase 1 완료

**이전 버전 (v1.2.0)**:
- PRD 구조 개선 (Quick Status, 구현 순서, 우선순위/의존성 명시)
- Phase 1 완료 상태로 업데이트
- 시스템 정보(날짜/시간) 표시 기능 추가
- Phase 2 구현 준비 완료

**이전 버전 (v1.1.0)**:
- Phase 1 드롭다운 메뉴 시스템 완료
- 한글 문자 너비 처리 구현 (unicode-width)
- 메뉴 네비게이션 UX 개선
